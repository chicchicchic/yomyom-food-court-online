"use strict";(self.webpackChunkonline_food_court=self.webpackChunkonline_food_court||[]).push([[521],{66521:(e,t,i)=>{i.r(t),i.d(t,{default:()=>q});var n=i(65043),s=i(17392),a=i(85865),r=i(19252),l=i(63336),o=i(68903),d=i(15795),c=i(53193),h=i(51292),m=i(35721),x=i(71322),u=i(17830),g=i(39336),j=i(57972),y=i(68577),p=i(34791),A=i(11906),f=i(15397),v=i(90035),b=i(26600),C=i(35316),S=i(98533),w=i(18356),k=i(69285),I=i(37970),P=i(29347),E=i(73216),F=i(73192),z=i(15505),B=i(77154),D=i(78662),N=i(74802),R=i(83003),T=i(21775),W=i(37762),L=i(75800),$=i(70579);const q=()=>{const e=(0,D.L4)(),t=(0,D.Kn)();let i=null;t&&(i=t.sub);const q=(0,E.zy)(),U=(0,E.Zp)(),M=(0,R.wA)(),{list:O}=q.state||{},[Y,_]=(0,n.useState)({userId:0,firstName:"",lastName:"",email:"",phone:""}),[H,K]=(0,n.useState)(""),[Q,V]=(0,n.useState)(""),[X,Z]=(0,n.useState)(""),[G,J]=(0,n.useState)("Cash on delivery"),[ee,te]=(0,n.useState)([]),[ie,ne]=(0,n.useState)(""),[se,ae]=n.useState(!1),re=(0,n.useRef)(null),le=(0,n.useRef)(null),oe=(0,n.useRef)(null),[de,ce]=(0,n.useState)(!1),[he,me]=(0,n.useState)("pdf");(0,n.useEffect)((()=>{null===i&&""!==i||xe(i),ue()}),[]);const xe=async t=>{try{const i=await B.A.get("".concat(L.y,"/user/find-by-email"),{params:{email:t},headers:{Authorization:"Bearer ".concat(e)}});console.log("User Details Basket:",i.data),i.data&&_(i.data)}catch(i){console.error("Error fetching User detail by email:",i)}},ue=()=>{const e=new Date,t=e.getHours(),i=e.getMinutes(),n=[];let s="";for(let a=2;a<24;a++){const e=a,r=a+1,l="".concat(e,":00 - ").concat(r,":00");e>=t&&(n.push(l),(e===t&&i<60||e>t&&""===s)&&(s=l))}te(n),ne(s||n[0])},ge=(e,t)=>+e*t,je=null===O||void 0===O?void 0:O.reduce(((e,t)=>e+ge((t.dish.originalPrice*(1-t.dish.discount/100)).toFixed(2),t.quantity)),0),ye=()=>{ae(!0)},pe=(e,t)=>{"clickaway"!==t&&ae(!1)},Ae=(0,$.jsx)(n.Fragment,{children:(0,$.jsx)(s.A,{size:"small","aria-label":"close",color:"inherit",onClick:pe,children:(0,$.jsx)(N.A,{fontSize:"small"})})}),fe=async t=>{try{await B.A.delete("".concat(L.y,"/basket/clear-all-items-from-basket/").concat(t),{headers:{Authorization:"Bearer ".concat(e)}})}catch(i){console.error("Error removing items from basket:",i),alert("Error removing items from basket: ".concat(i.message))}},ve=async()=>{try{const t=O.map((e=>({dishId:e.dish.dishId,quantity:e.quantity,totalPrice:ge((e.dish.originalPrice*(1-e.dish.discount/100)).toFixed(2),e.quantity),createdBy:Y.email,updatedBy:Y.email}))),i={userId:Y.userId,address:H,phone:Q||Y.phone,totalPayment:je,paymentMethod:G,deliveryTime:ie,notes:X,orderItems:t,createdBy:Y.email,updatedBy:Y.email};await B.A.post("".concat(L.y,"/order/create"),i,{headers:{Authorization:"Bearer ".concat(e)}});ce(!0)}catch(t){alert("Error placing order !")}},be=e=>{ce(!1),e&&Ce(),"Cash on delivery"===G?(ye(),setTimeout((()=>{fe(Y.userId),M((0,T.xS)(0)),U("/order-tracking",{state:{userId:Y.userId,userFirstName:Y.firstName,userEmail:Y.email,shippingAddress:H,shippingPhone:Q||Y.phone}})}),2e3)):"Credit Card"===G&&(ye(),setTimeout((()=>{fe(Y.userId),M((0,T.xS)(0)),U("/go-to-payment-credit-card")}),2e3))},Ce=()=>{console.log("Exporting bill.......");const e=(new Date).toLocaleString(),t=je||0;let i="\n                                    Yomyom Food Court\n                            123 Ngo Duc Ke, District 1, HCMC\n                                     tel: 02822539177\n                                  ".concat(e,"\n      =========================================================================\n      =========================================================================\n                           QTY                 PRICE                VALUE\n    ");O.forEach(((e,t)=>{i+="\n        ".concat(t+1,".").concat(e.dish.name.padEnd(20)," \n\n        ").concat("".padEnd(20)).concat(e.quantity.toString().padEnd(20),"$").concat((e.dish.originalPrice*(1-e.dish.discount/100)).toString().padEnd(20),"$").concat(ge((e.dish.originalPrice*(1-e.dish.discount/100)).toFixed(2),e.quantity)," \n\n      ")})),i+="\n      =========================================================================\n                                                     Total:          $".concat(t.toString(),"\n    "),"txt"===he?Se(i):"pdf"===he&&we(i)},Se=e=>{const t=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download="bill.txt",n.click(),URL.revokeObjectURL(i)},we=e=>{const t=new W.Ay;t.text(e,10,10),t.save("bill.pdf")};return(0,$.jsxs)($.Fragment,{children:[i&&O&&0!==O.length?(0,$.jsxs)(r.A,{maxWidth:"lg",children:[(0,$.jsx)(a.A,{variant:"h4",gutterBottom:!0,sx:{textAlign:"center",fontSize:30,fontWeight:600},children:"Payment"}),(0,$.jsx)(l.A,{elevation:3,sx:{padding:3,marginBottom:3},children:(0,$.jsxs)(o.Ay,{container:!0,spacing:3,children:[(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsxs)(a.A,{variant:"body1",children:["Name: ",Y.firstName||"Default Name"," - ID:"," ",Y.userId||"unknown"]})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsxs)(a.A,{variant:"body1",children:["Total Items: ",O.length]})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsx)(d.A,{fullWidth:!0,variant:"outlined",value:Y.firstName||Y.lastName?Y.firstName+" "+Y.lastName:"Default Fullname",disabled:!0})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsx)(d.A,{fullWidth:!0,variant:"outlined",value:Y.email||"Default Email",disabled:!0})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsx)(d.A,{fullWidth:!0,type:"text",variant:"outlined",label:(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:["What is your shipping address ?",(0,$.jsx)(a.A,{component:"p",sx:{color:"red",marginLeft:"0.2rem"},children:"(*)"})]}),value:H,onChange:e=>K(e.target.value),inputRef:re})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsx)(d.A,{fullWidth:!0,type:"number",variant:"outlined",label:(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:['Can deliver contact you with "',Y.phone,'" ?',(0,$.jsx)(a.A,{component:"p",sx:{color:"red",marginLeft:"0.2rem"},children:"(*)"})]}),value:Q,placeholder:"Enter new phone number (if any)",onChange:e=>{const t=e.target.value;!t||/^\d*$/.test(t)?V(t):V(Y.phone||"")},inputRef:le})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsx)(d.A,{fullWidth:!0,variant:"outlined",value:"Delivery Date: Today",disabled:!0})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:(0,$.jsxs)(c.A,{fullWidth:!0,children:[(0,$.jsxs)(h.A,{sx:{display:"flex",alignItems:"center"},children:["Delivery Time:",(0,$.jsx)(a.A,{component:"p",sx:{color:"red",marginLeft:"0.2rem"},children:"(*)"})]}),(0,$.jsx)("select",{id:"deliveryTime",value:ie,onChange:e=>ne(e.target.value),style:{padding:"0.4rem"},ref:oe,children:ee.map(((e,t)=>(0,$.jsx)("option",{value:e,children:e},t)))})]})}),(0,$.jsx)(o.Ay,{item:!0,xs:12,sm:12,md:12,lg:12,children:(0,$.jsx)(d.A,{fullWidth:!0,variant:"outlined",label:"Do you have any notes for us ?",multiline:!0,rows:4,value:X,onChange:e=>Z(e.target.value)})})]})}),(0,$.jsxs)(l.A,{elevation:3,sx:{padding:3,marginBottom:3},children:[(0,$.jsx)(a.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:"16px"},children:"Order Items"}),(0,$.jsx)(m.A,{children:O.map(((e,t)=>(0,$.jsxs)("div",{children:[(0,$.jsx)(x.Ay,{children:(0,$.jsxs)(o.Ay,{container:!0,spacing:2,children:[(0,$.jsx)(o.Ay,{item:!0,xs:4,sm:3,md:2,children:(0,$.jsx)(u.A,{src:"data:image/jpeg;base64, ".concat(e.dish.image),sx:{width:100,height:100,borderRadius:1,"@media (max-width: 375px)":{width:80,height:80}}})}),(0,$.jsx)(o.Ay,{item:!0,xs:8,sm:9,md:10,children:(0,$.jsxs)(o.Ay,{container:!0,children:[(0,$.jsxs)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:[(0,$.jsx)(a.A,{variant:"h6",children:e.dish.name}),(0,$.jsxs)(a.A,{variant:"body1",children:["Price:"," ",(0,$.jsxs)("b",{children:[e.dish.discount>0&&(0,$.jsx)($.Fragment,{children:(0,$.jsx)("del",{style:{marginRight:"0.5rem"},children:"$".concat(e.dish.originalPrice)})}),(0,$.jsx)("span",{children:"$".concat((e.dish.originalPrice*(1-e.dish.discount/100)).toFixed(2))})]})]})]}),(0,$.jsxs)(o.Ay,{item:!0,xs:12,sm:6,md:6,lg:6,children:[(0,$.jsxs)(a.A,{variant:"body1",children:["Quantity: ",(0,$.jsx)("b",{children:e.quantity})]}),(0,$.jsxs)(a.A,{variant:"body1",children:["Total Price:"," ",(0,$.jsxs)("b",{children:["$",ge((e.dish.originalPrice*(1-e.dish.discount/100)).toFixed(2),e.quantity)]})]})]})]})})]})},t),(0,$.jsx)(g.A,{component:"li"})]})))})]}),(0,$.jsx)(l.A,{elevation:3,sx:{padding:3,marginBottom:3},children:(0,$.jsxs)(c.A,{component:"fieldset",children:[(0,$.jsx)(a.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:"16px"},children:"Payment Method"}),(0,$.jsxs)(j.A,{value:G,onChange:e=>J(e.target.value),children:[(0,$.jsx)(y.A,{value:"Cash on delivery",control:(0,$.jsx)(p.A,{}),label:(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,$.jsx)(F.A,{style:{marginRight:8}}),"Cash on delivery"]})}),(0,$.jsx)(y.A,{value:"Credit Card",control:(0,$.jsx)(p.A,{}),label:(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,$.jsx)(z.A,{style:{marginRight:8}}),"Credit Cart"]})})]})]})}),(0,$.jsxs)(l.A,{elevation:3,sx:{padding:3,marginBottom:3},children:[(0,$.jsxs)(o.Ay,{container:!0,justifyContent:"space-between",children:[(0,$.jsx)(o.Ay,{item:!0,xs:9,sm:10,md:11,lg:11,children:(0,$.jsx)(a.A,{variant:"h6",sx:{fontSize:"20px"},children:"Merchandise Subtotal:"})}),(0,$.jsx)(o.Ay,{item:!0,xs:3,sm:2,md:1,lg:1,children:(0,$.jsx)(a.A,{variant:"h6",sx:{fontSize:"20px"},children:(0,$.jsxs)("b",{children:["$",je]})})})]}),(0,$.jsxs)(o.Ay,{container:!0,justifyContent:"space-between",children:[(0,$.jsx)(o.Ay,{item:!0,xs:9,sm:10,md:11,lg:11,children:(0,$.jsx)(a.A,{variant:"h6",sx:{fontSize:"20px"},children:"Shipping Subtotal:"})}),(0,$.jsx)(o.Ay,{item:!0,xs:3,sm:2,md:1,lg:1,children:(0,$.jsx)(a.A,{variant:"h6",sx:{fontSize:"20px"},children:(0,$.jsx)("b",{children:"Free"})})})]}),(0,$.jsxs)(o.Ay,{container:!0,justifyContent:"space-between",children:[(0,$.jsx)(o.Ay,{item:!0,xs:9,sm:10,md:11,lg:11,children:(0,$.jsx)(a.A,{variant:"h6",sx:{fontSize:"20px"},children:"Total Payment:"})}),(0,$.jsx)(o.Ay,{item:!0,xs:3,sm:2,md:1,lg:1,children:(0,$.jsx)(a.A,{variant:"h6",sx:{fontSize:"20px",color:"red"},children:(0,$.jsxs)("b",{children:["$",je]})})})]})]}),(0,$.jsx)("div",{style:{textAlign:"right",marginTop:"2rem"},children:(0,$.jsx)(A.A,{variant:"contained",color:"primary",sx:{fontSize:"14px",backgroundColor:H&&(Q||Y.phone)&&ie?"primary.main":"gray",cursor:H&&(Q||Y.phone)&&ie?"pointer":"not-allowed"},onClick:()=>{H?Q||Y.phone?ie?ve():oe.current&&oe.current.focus():le.current&&le.current.focus():re.current&&re.current.focus()},children:"Place Order"})})]}):(0,$.jsx)(n.Fragment,{children:(0,$.jsx)(a.A,{variant:"h5",children:"No payment information available!"})}),(0,$.jsx)(f.A,{open:se,autoHideDuration:6e3,onClose:pe,message:"Order placed successfully !",action:Ae,sx:{"& .MuiSnackbarContent-root":{backgroundColor:"green",color:"white"}}}),(0,$.jsxs)(v.A,{open:de,onClose:()=>ce(!1),"aria-labelledby":"confirmation-dialog-title","aria-describedby":"confirmation-dialog-description",children:[(0,$.jsx)(b.A,{id:"confirmation-dialog-title",children:"Order Confirmation"}),(0,$.jsxs)(C.A,{children:[(0,$.jsx)(S.A,{id:"confirmation-dialog-description",children:"Your order has been placed successfully. Do you want to export the bill?"}),(0,$.jsxs)(c.A,{fullWidth:!0,children:[(0,$.jsx)(w.A,{id:"file-format-label",children:"File Format"}),(0,$.jsxs)(k.A,{labelId:"file-format-label",value:he,onChange:e=>{me(e.target.value)},children:[(0,$.jsx)(I.A,{value:"pdf",children:"PDF"}),(0,$.jsx)(I.A,{value:"txt",children:"TXT"})]})]})]}),(0,$.jsxs)(P.A,{children:[(0,$.jsx)(A.A,{onClick:()=>be(!1),color:"primary",children:"No"}),(0,$.jsx)(A.A,{onClick:()=>be(!0),color:"primary",autoFocus:!0,children:"Yes"})]})]})]})}}}]);
//# sourceMappingURL=521.65cf3205.chunk.js.map